<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"
        />
        <title><%= htmlWebpackPlugin.options.title %></title>
        <% for (var css in htmlWebpackPlugin.files.css) { %>
        <link href="<%= htmlWebpackPlugin.files.css[css] %>" rel="stylesheet" />
        <% } %>
        <link href="https://playentry.org/lib/entry-tool/dist/entry-tool.css" rel="stylesheet" />
        <link href="https://playentry.org/lib/entry-lms/dist/assets/app.css" rel="stylesheet" />
    </head>

    <body>

        <section>
            <button onClick="exportfunc()">export</button>
        </section>
        <!--main space -->
        <div id="workspace"></div>

        <!--language-->
        <script src="../extern/lang/ko.js"></script>

        <script
            type="text/javascript"
            src="https://playentry.org/lib/PreloadJS/lib/preloadjs-0.6.0.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/EaselJS/lib/easeljs-0.8.0.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/SoundJS/lib/soundjs-0.6.0.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/SoundJS/lib/flashaudioplugin-0.6.0.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/lodash/dist/lodash.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/jquery/jquery.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/jquery-ui/ui/minified/jquery-ui.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/velocity/velocity.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/codemirror/lib/codemirror.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/codemirror/addon/hint/show-hint.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/codemirror/addon/lint/lint.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/codemirror/addon/selection/active-line.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/codemirror/mode/javascript/javascript.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/codemirror/addon/hint/javascript-hint.js"
        ></script>
        <script type="text/javascript" src="https://playentry.org/js/jshint.js"></script>
        <script type="text/javascript" src="https://playentry.org/lib/fuzzy/lib/fuzzy.js"></script>
        <script type="text/javascript" src="https://playentry.org/js/ws/python.js"></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/entry-js/extern/util/filbert.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/entry-js/extern/util/CanvasInput.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/entry-js/extern/util/ndgmr.Collision.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/entry-js/extern/util/handle.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/entry-js/extern/util/bignumber.min.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/socket.io-client/socket.io.js"
        ></script>
        <script type="text/javascript" src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/entry-lms/dist/assets/app.js"
        ></script>
        <script src="../extern/util/static.js"></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/entry-tool/dist/entry-tool.js"
        ></script>
        <script
            type="text/javascript"
            src="https://playentry.org/lib/entry-paint/dist/static/js/entry-paint.js"
        ></script>
        <script
            type="text/javascript"
            src="https://entry-cdn.pstatic.net/external/sound/sound-editor.js?v=240130-174210"
        ></script>

        <% for (var chunk in htmlWebpackPlugin.files.js) { %>
        <script src="<%= htmlWebpackPlugin.files.js[chunk] %>"></script>
        <% } %>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>

        <script>
            function handleUpdate() {
                const file = document.getElementById('litemodule').files[0];
                const name = document.getElementById('litemodulename').value;
                Entry.loadLiteTestModule(file, name);
            }
            function exportfunc(){
                var blockData = Entry.exportProject();
                console.log(JSON.parse(blockData.objects[0].script))
            }

     


        </script>
        <!--main script-->
        <script>
            window.PUBLIC_PATH_FOR_ENTRYJS = 'lib/entry-js/dist/';
            $(document).ready(function() {
                var initOption = {
                    type: 'workspace',
                    textCodingEnable: false, //파이썬 끄기 
                    sceneEditable:false, //단일 장면으로 사용
                    objectaddable:false, //오브젝트 추가하기 버튼 isShow 여부 
                    soundeditable:true, //소리TAB (현재 지원안하는 서비스)
                };
                Entry.creationChangedEvent = new Entry.Event(window);
                Entry.init(document.getElementById('workspace'), initOption);

                Entry.loadProject({
  "objects": [
    {
      "id": "7y0y",
      "name": "엔트리봇",
      "script": "[[{\"id\":\"fw23\",\"x\":53,\"y\":88,\"type\":\"when_run_button_click\",\"params\":[null],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},{\"id\":\"i6bt\",\"x\":0,\"y\":0,\"type\":\"ask_and_wait\",\"params\":[{\"id\":\"ebb5\",\"x\":0,\"y\":0,\"type\":\"text\",\"params\":[\"이자(%)를 입력하세요\"],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},null],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},{\"id\":\"xi85\",\"x\":0,\"y\":0,\"type\":\"set_variable\",\"params\":[\"h76s\",{\"id\":\"sncm\",\"x\":0,\"y\":0,\"type\":\"get_canvas_input_value\",\"params\":[null],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},null],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},{\"id\":\"rtls\",\"x\":0,\"y\":0,\"type\":\"set_variable\",\"params\":[\"rb0l\",{\"id\":\"940t\",\"x\":0,\"y\":0,\"type\":\"calc_basic\",\"params\":[{\"id\":\"it4t\",\"x\":0,\"y\":0,\"type\":\"get_variable\",\"params\":[\"h76s\",null],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},\"DIVIDE\",{\"id\":\"187p\",\"x\":0,\"y\":0,\"type\":\"number\",\"params\":[\"100\"],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]}],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},null],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},{\"id\":\"nx5x\",\"x\":0,\"y\":0,\"type\":\"dialog\",\"params\":[{\"id\":\"uohx\",\"x\":0,\"y\":0,\"type\":\"get_variable\",\"params\":[\"rb0l\",null],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]},\"speak\",null],\"statements\":[],\"movable\":null,\"deletable\":1,\"emphasized\":false,\"readOnly\":null,\"copyable\":true,\"assemble\":true,\"extensions\":[]}]]",
      "objectType": "sprite",
      "rotateMethod": "free",
      "scene": "7dwq",
      "sprite": {
        "pictures": [
          {
            "id": "vx80",
            "dimension": {
              "width": 144,
              "height": 246,
              "scaleX": 0.5128205128205128,
              "scaleY": 0.5128205128205128
            },
            "fileurl": "./bower_components/entry-js/images/media/entrybot1.svg",
            "name": "엔트리봇_걷기1",
            "imageType": "svg"
          },
          {
            "id": "4t48",
            "dimension": { "width": 144, "height": 246 },
            "fileurl": "./bower_components/entry-js/images/media/entrybot2.svg",
            "name": "엔트리봇_걷기2",
            "imageType": "svg"
          }
        ],
        "sounds": [
          {
            "duration": 1.3,
            "ext": ".mp3",
            "id": "8el5",
            "fileurl": "./bower_components/entry-js/images/media/bark.mp3",
            "name": "강아지 짖는 소리"
          }
        ]
      },
      "selectedPictureId": "vx80",
      "lock": false,
      "entity": {
        "x": 0,
        "y": 0,
        "regX": 72,
        "regY": 123,
        "scaleX": 0.5128205128205128,
        "scaleY": 0.5128205128205128,
        "rotation": 0,
        "direction": 90,
        "width": 144,
        "height": 246,
        "font": "undefinedpx ",
        "visible": true
      }
    }
  ],
  "scenes": [{ "id": "7dwq", "name": "장면 1" }],
  "variables": [
    {
      "name": "일년 후 금액",
      "id": "c3x5",
      "visible": true,
      "value": 0,
      "variableType": "variable",
      "isCloud": false,
      "isRealTime": false,
      "cloudDate": false,
      "object": null,
      "x": -218.72483221476512,
      "y": 40.772894321121356
    },
    {
      "name": "이자율",
      "id": "rb0l",
      "visible": true,
      "value": 0,
      "variableType": "variable",
      "isCloud": false,
      "isRealTime": false,
      "cloudDate": false,
      "object": null,
      "x": -220.33557046979865,
      "y": -37.1753008112684
    },
    {
      "name": "한달 후 이자금 계",
      "id": "0uq6",
      "visible": true,
      "value": 0,
      "variableType": "variable",
      "isCloud": false,
      "isRealTime": false,
      "cloudDate": false,
      "object": null,
      "x": -220.3355704697987,
      "y": 1.5512825309811973
    },
    {
      "name": "이자",
      "id": "h76s",
      "visible": true,
      "value": "0",
      "variableType": "variable",
      "isCloud": false,
      "isRealTime": false,
      "cloudDate": false,
      "object": null,
      "x": -218.72483221476517,
      "y": -72.19073780422566
    },
    {
      "name": "저금 금액",
      "id": "pyy5",
      "visible": true,
      "value": 0,
      "variableType": "variable",
      "isCloud": false,
      "isRealTime": false,
      "cloudDate": false,
      "object": null,
      "x": -217.11409395973155,
      "y": -112.26792276901197
    },
    {
      "name": "초시계",
      "id": "brih",
      "visible": false,
      "value": 0,
      "variableType": "timer",
      "isCloud": false,
      "isRealTime": false,
      "cloudDate": false,
      "object": null,
      "x": 134,
      "y": -70
    },
    {
      "name": " 대답 ",
      "id": "1vu8",
      "visible": true,
      "value": "0",
      "variableType": "answer",
      "isCloud": false,
      "isRealTime": false,
      "cloudDate": false,
      "object": null,
      "x": 150,
      "y": -100
    }
  ],
  "messages": [],
  "functions": [],
  "tables": [],
  "speed": 60,
  "interface": { "canvasWidth": 324, "menuWidth": 258, "object": "7y0y" },
  "expansionBlocks": [],
  "aiUtilizeBlocks": [],
  "hardwareLiteBlocks": [],
  "externalModules": [],
  "externalModulesLite": [],
  "likeCnt": 0,
  "visit": 0,
  "isopen": true,
  "name": "mission01",
  "isPracticalCourse": false,
  "parent": "65d000bd0a284e0025e559f9",
  "origin": "65bf2e9318ddc800259b3d05",
  "user": "58f0b18c46d3696ceb4a3bb3",
  "recentLikeCnt": 0,
  "childCnt": 0,
  "comment": 0
}
);
                window.addEventListener("message", async (event) => {
                console.log('부모 도메인',event.origin)
                if (event.origin === "http://192.168.155.155:5173") {
                    if (event.data.type === "init") {
                        //초기 프로젝트로 로드
                        const blockData = event.data.blockData;
                        console.log(
                            "엔트리: ㅇㅇ 처음 프로젝트 시작이얌",
                            blockData
                        );
                        if(blockData !==null){
                            console.log('엔트리: 불러오기 로드')
                            Entry.clearProject() ;
                            Entry.loadProject(blockData);
                        }else{
                            console.log('엔트리: 찐처음 로드')          
                        }

                    }
                    if (event.data.type === "save") {
                        //임시저장
                        var blockData = Entry.exportProject();
                        console.log("엔트리: 응그래 지금까지 한거 파일 드림");
                        window.parent.postMessage(
                            {
                                data: blockData, //jsonData
                                img: "",
                                isDone: false,
                            },
                            "http://192.168.155.155:5173"
                        );
                    }
                    if (event.data.type === "done") {
                        //채점
                        var blockData = Entry.exportProject();
                        console.log("엔트리: 응그래 다했니 니파일 정보 드림");
                        const captureDiv = document.getElementById('capture')
                        html2canvas(captureDiv).then((canvas)=>{
                            canvas.toBlob(blob=>{
                                window.parent.postMessage(
                            {
                                data: blockData, //jsonData
                                img: blob, //blobData
                                isDone: true,
                            },
                            "http://192.168.155.155:5173"
                        );
                            })
                        })
                       
                    }
                }
            });
                
             
            });
        </script>


    </body>
</html>
